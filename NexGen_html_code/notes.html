<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notes Repository | NexGen</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* --- THEME VARIABLES --- */
:root {
    --primary: #3b82f6;
    --primary-glow: rgba(59, 130, 246, 0.4);
    --bg-body: #f8fafc;
    --bg-sidebar: rgba(255, 255, 255, 0.85);
    --bg-card: #ffffff;
    --bg-hover: #f1f5f9;
    --bg-input: rgba(255, 255, 255, 0.5);
    --border: #e2e8f0;
    --text-main: #0f172a;
    --text-muted: #64748b;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    --glass-blur: blur(12px);
    --success: #10b981;
    --danger: #ef4444;
}

[data-theme="dark"] {
    --primary: #818cf8;
    --primary-glow: rgba(129, 140, 248, 0.3);
    --bg-body: linear-gradient(135deg, #020617 0%, #1e1b4b 50%, #172554 100%);
    --bg-sidebar: rgba(15, 23, 42, 0.6);
    --bg-card: rgba(30, 41, 59, 0.7);
    --bg-hover: rgba(51, 65, 85, 0.8);
    --bg-input: rgba(15, 23, 42, 0.6);
    --border: rgba(255, 255, 255, 0.08);
    --text-main: #f8fafc;
    --text-muted: #94a3b8;
    --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    --glass-blur: blur(20px); 
}

/* --- RESET & BASE --- */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; transition: background 0.4s ease, color 0.2s ease, border-color 0.3s ease; }
body { height: 100vh; display: flex; background: var(--bg-body); background-size: 200% 200%; color: var(--text-main); overflow: hidden; }

/* --- SIDEBAR --- */
.sidebar { width: 270px; background: var(--bg-sidebar); backdrop-filter: var(--glass-blur); border-right: 1px solid var(--border); padding: 24px 16px; display: flex; flex-direction: column; z-index: 20; flex-shrink: 0; overflow-y: auto; }
.sidebar::-webkit-scrollbar { width: 5px; }
.sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

.logo-container { display: flex; align-items: center; gap: 12px; padding: 0 12px 20px; }
.logo-icon { width: 34px; height: 34px; background: linear-gradient(135deg, var(--primary), #4f46e5); border-radius: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 15px var(--primary-glow); overflow: hidden; }
.logo-img { width: 100%; height: 100%; object-fit: cover; }
.logo-text { font-size: 1.3rem; font-weight: 700; color: var(--text-main); }
.sidebar-divider { height: 1px; background: var(--border); margin: 8px 8px 20px; }
.section-label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); letter-spacing: 0.05em; margin: 20px 12px 10px; }

.nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 12px; color: var(--text-muted); text-decoration: none; font-size: 0.95rem; font-weight: 500; margin-bottom: 4px; cursor: pointer; position: relative; overflow: hidden; z-index: 1; }
.nav-item::before { content: ''; position: absolute; top: 0; left: 0; bottom: 0; right: 0; background: var(--bg-hover); z-index: -1; border-radius: 12px; transform: scaleX(0); transform-origin: left; transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
.nav-item.active { color: var(--primary); font-weight: 600; }
.nav-item.active::before { transform: scaleX(1); background: var(--bg-hover); opacity: 0.5; }
.nav-item.active i { color: var(--primary); }
.nav-item:hover { color: var(--text-main); transform: translateX(6px); }
.nav-item:hover::before { transform: scaleX(1); }
.nav-item i { width: 24px; text-align: center; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
.nav-item:hover i { transform: scale(1.15) rotate(5deg); color: var(--primary); }

/* --- HEADER --- */
.main-layout { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
.top-bar { height: 72px; padding: 0 32px; display: flex; align-items: center; justify-content: space-between; background: var(--bg-sidebar); backdrop-filter: var(--glass-blur); border-bottom: 1px solid var(--border); z-index: 10; }
.search-wrapper { position: relative; width: 400px; }
.search-input { width: 100%; padding: 11px 16px 11px 44px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg-input); color: var(--text-main); font-size: 0.9rem; }
.search-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-glow); background: var(--bg-card); }
.search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
.header-actions { display: flex; align-items: center; gap: 16px; }
.action-btn { width: 42px; height: 42px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-muted); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); }
.action-btn:hover { background: var(--bg-hover); color: var(--text-main); border-color: var(--primary); transform: translateY(-2px); }
.profile-avatar { width: 42px; height: 42px; border-radius: 12px; background: linear-gradient(135deg, #6366f1, #d946ef); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; cursor: pointer; }

/* --- NOTES REPO STYLES --- */
.content-area { flex: 1; padding: 32px; overflow-y: auto; display: flex; flex-direction: column; gap: 32px; }

.page-header { display: flex; justify-content: space-between; align-items: center; }
.page-title h2 { font-size: 1.8rem; font-weight: 700; margin-bottom: 5px; }
.page-title p { color: var(--text-muted); }

/* Hero Search */
.repo-search-container {
    background: linear-gradient(135deg, #8b5cf6, #d946ef); /* Different gradient for variety */
    border-radius: 20px; padding: 40px; color: white; text-align: center;
    box-shadow: 0 10px 30px -5px rgba(139, 92, 246, 0.4);
    position: relative; overflow: hidden;
}
.repo-search-container::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
    animation: rotate 20s linear infinite;
}
@keyframes rotate { from {transform: rotate(0deg);} to {transform: rotate(360deg);} }

.hero-content { position: relative; z-index: 1; max-width: 600px; margin: 0 auto; }
.hero-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 20px; }
.big-search-box { position: relative; width: 100%; }
.big-search-input {
    width: 100%; padding: 16px 24px 16px 50px; border-radius: 14px;
    border: none; font-size: 1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    outline: none; color: #1e293b;
}
.big-search-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #64748b; font-size: 1.1rem; }

/* Notes Grid */
.notes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; }

.note-card {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 16px; padding: 20px;
    transition: transform 0.3s, box-shadow 0.3s;
    display: flex; flex-direction: column; gap: 15px;
    position: relative; overflow: hidden;
}
.note-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: var(--primary); }

.note-icon-box {
    width: 50px; height: 50px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.5rem; margin-bottom: 5px;
}
.icon-pdf { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
.icon-doc { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
.icon-img { background: rgba(16, 185, 129, 0.1); color: #10b981; }

.note-info h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 5px; color: var(--text-main); }
.note-course { font-size: 0.85rem; color: var(--primary); font-weight: 600; background: var(--bg-hover); padding: 4px 8px; border-radius: 6px; display: inline-block; margin-bottom: 8px; }
.note-desc { font-size: 0.9rem; color: var(--text-muted); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

.note-footer {
    margin-top: auto; padding-top: 15px; border-top: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
    font-size: 0.8rem; color: var(--text-muted);
}
.author-info { display: flex; align-items: center; gap: 6px; }
.author-avatar { width: 24px; height: 24px; border-radius: 50%; background: #cbd5e1; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 700; color: #475569; }

.download-btn {
    padding: 6px 12px; border-radius: 8px; background: var(--bg-hover);
    color: var(--text-main); border: 1px solid var(--border); cursor: pointer;
    font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 6px;
    justify-content: center;
}
.download-btn:hover { background: var(--bg-input); color: var(--primary); border-color: var(--primary); }

/* --- MODAL STYLES --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
    display: none; align-items: center; justify-content: center; z-index: 2000;
}
.modal-content {
    background: var(--bg-card); padding: 30px; border-radius: 20px;
    width: 500px; border: 1px solid var(--border); box-shadow: var(--shadow);
    animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.modal-content h3 { margin-bottom: 20px; font-size: 1.3rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }

.form-group { margin-bottom: 16px; }
.form-label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 6px; color: var(--text-main); }
.form-input, .form-textarea {
    width: 100%; padding: 12px 16px;
    background: var(--bg-input); border: 1px solid var(--border);
    border-radius: 10px; color: var(--text-main); font-size: 0.95rem; outline: none;
}
.form-input:focus, .form-textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-glow); }
.form-textarea { resize: vertical; min-height: 80px; }

/* File Upload Box */
.file-upload-box {
    border: 2px dashed var(--border); border-radius: 12px;
    padding: 20px; text-align: center; cursor: pointer;
    transition: all 0.2s; position: relative;
}
.file-upload-box:hover { border-color: var(--primary); background: var(--bg-hover); }
.file-upload-box i { font-size: 2rem; color: var(--text-muted); margin-bottom: 10px; }
.file-upload-box p { font-size: 0.9rem; color: var(--text-muted); }
.file-input-hidden { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
.file-name-display { font-weight: 600; color: var(--primary); margin-top: 5px; display: none; }

.modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 25px; padding-top: 15px; border-top: 1px solid var(--border); }
.save-btn { 
    background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 12px; cursor: pointer; font-weight: 600; 
    display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px var(--primary-glow); transition: all 0.2s;
}
.save-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px var(--primary-glow); }
.cancel-btn { 
    background: transparent; border: 1px solid var(--border); color: var(--text-muted); 
    padding: 12px 24px; border-radius: 12px; cursor: pointer; font-weight: 600; 
    display: flex; align-items: center; justify-content: center; transition: all 0.2s;
}
.cancel-btn:hover { background: var(--bg-hover); color: var(--text-main); border-color: var(--text-muted); }

/* --- AI WIDGET --- */
.ai-widget { position: absolute; bottom: 30px; right: 30px; z-index: 999; }
.ai-minimized { background: var(--bg-card); backdrop-filter: blur(16px); border: 1px solid var(--border); border-radius: 50px; padding: 12px 24px; box-shadow: var(--shadow); color: var(--text-main); font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: transform 0.3s; }
.ai-minimized:hover { transform: translateY(-3px) scale(1.02); }
.widget-status { width: 8px; height: 8px; background: #10b981; border-radius: 50%; box-shadow: 0 0 10px #10b981; }
.chat-interface { position: absolute; bottom: 0; right: 0; width: 380px; height: 550px; background: var(--bg-card); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); display: flex; flex-direction: column; overflow: hidden; opacity: 0; pointer-events: none; transform: translateY(20px) scale(0.95); transition: all 0.4s; }
.ai-widget.expanded .chat-interface { opacity: 1; pointer-events: auto; transform: translateY(0) scale(1); }
.ai-widget.expanded .ai-minimized { opacity: 0; pointer-events: none; display: none; }
.chat-header { padding: 18px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; background: rgba(255, 255, 255, 0.05); }
.ai-profile { display: flex; align-items: center; gap: 10px; font-weight: 600; }
.ai-avatar-small { width: 32px; height: 32px; border-radius: 8px; background: linear-gradient(135deg, #10b981, #059669); display: flex; align-items: center; justify-content: center; color: white; }
.close-chat { background: none; border: none; color: var(--text-muted); cursor: pointer; }
.chat-body { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px; }
.msg { padding: 12px 16px; font-size: 0.9rem; line-height: 1.5; max-width: 85%; border-radius: 12px; animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
@keyframes popIn { from { opacity: 0; transform: translateY(10px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
.msg-user { align-self: flex-end; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border-radius: 18px 18px 0 18px; }
.msg-ai { align-self: flex-start; background: var(--bg-hover); border: 1px solid var(--border); color: var(--text-main); border-radius: 18px 18px 18px 0; }
.chat-footer { padding: 16px; }
.chat-input-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 50px; padding: 6px 6px 6px 16px; display: flex; align-items: center; }
.chat-input { flex: 1; border: none; background: transparent; outline: none; color: var(--text-main); }
.send-btn { width: 36px; height: 36px; border-radius: 50%; background: var(--primary); color: white; border: none; cursor: pointer; }

/* Typing Indicator Animation */
.typing-indicator { display: flex; gap: 4px; padding: 12px 16px; align-self: flex-start; background: var(--bg-hover); border-radius: 18px; border: 1px solid var(--border); width: fit-content; }
.dot { width: 6px; height: 6px; background: var(--text-muted); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
.dot:nth-child(1) { animation-delay: -0.32s; }
.dot:nth-child(2) { animation-delay: -0.16s; }
@keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

/* Mobile */
@media (max-width: 1024px) {
    .sidebar { position: fixed; transform: translateX(-100%); transition: transform 0.3s; }
    .sidebar.open { transform: translateX(0); }
}
</style>
</head>
<body>

<div class="sidebar">
    <div class="logo-container">
        <div class="logo-icon"><img src="NexGen-logo.jpg" alt="NexGen Logo" class="logo-img"></div>
        <span class="logo-text">NexGen</span>
    </div>
    <div class="sidebar-divider"></div>
    <a href="dashboard.html" class="nav-item"><i class="fa-solid fa-house-chimney"></i>Dashboard</a>
    
    <div class="section-label">Academics</div>
    <a href="aipapergen.html" class="nav-item"><i class="fa-solid fa-wand-magic-sparkles"></i>AI Paper Gen</a>
    <a href="syllabus.html" class="nav-item"><i class="fa-solid fa-crosshairs"></i>Syllabus Tracker</a>
    
    <div class="section-label">Community</div>
    <a href="#" class="nav-item active"><i class="fa-solid fa-brain"></i>Notes Repo</a>
    <a href="channels.html" class="nav-item"><i class="fa-solid fa-code-branch"></i>Branch Channel</a>
    
    <div class="section-label">Tools</div>
    <a href="editor.html" class="nav-item"><i class="fa-solid fa-terminal"></i>Code Editor</a>
    
    <div class="section-label">Database</div>
    <a href="archive.html" class="nav-item"><i class="fa-solid fa-database"></i>PYQ Archive</a>
    <a href="syllabus-list.html" class="nav-item"><i class="fa-solid fa-list-check"></i>Syllabus List</a>
    <a href="notes.html" class="nav-item"><i class="fa-solid fa-folder-open"></i>Notes Library</a>
</div>

<div class="main-layout">
    
    <div class="top-bar">
        <div class="search-wrapper">
            <i class="fa-solid fa-magnifying-glass search-icon"></i>
            <input type="text" class="search-input" placeholder="Search notes, authors...">
        </div>
        <div class="header-actions">
            <button class="action-btn" id="theme-toggle"><i class="fa-solid fa-moon"></i></button>
            <button class="action-btn"><i class="fa-regular fa-bell"></i></button>
            <div class="profile-avatar">JD</div>
        </div>
    </div>

    <div class="content-area">
        
        <div class="page-header">
            <div class="page-title">
                <h2>Notes Repository</h2>
                <p>Share and access study materials from the community.</p>
            </div>
            <button class="action-btn" style="width:auto; padding:0 20px; gap:10px; font-weight:600; color:var(--primary); border-color:var(--primary);" onclick="openUploadModal()">
                <i class="fa-solid fa-cloud-arrow-up"></i> Upload Note
            </button>
        </div>

        <!-- HERO SEARCH -->
        <div class="repo-search-container">
            <div class="hero-content">
                <div class="hero-title">Discover Knowledge</div>
                <div class="big-search-box">
                    <i class="fa-solid fa-magnifying-glass big-search-icon"></i>
                    <input type="text" class="big-search-input" id="repoSearch" placeholder="Find notes by title, code or author..." onkeyup="filterNotes()">
                </div>
            </div>
        </div>

        <div class="notes-grid" id="notesGrid">
            
            <!-- Existing Note 1 -->
            <div class="note-card" data-title="Thermodynamics Basics" data-code="ME201" data-author="Dr. Smith">
                <div class="note-icon-box icon-pdf"><i class="fa-solid fa-file-pdf"></i></div>
                <div class="note-info">
                    <span class="note-course">ME201</span>
                    <h3>Thermodynamics Basics</h3>
                    <p class="note-desc">Comprehensive notes on laws of thermodynamics, entropy, and heat transfer mechanisms.</p>
                </div>
                <div class="note-footer">
                    <div class="author-info">
                        <div class="author-avatar">DS</div>
                        <span>Dr. Smith</span>
                    </div>
                    <span>Oct 24, 2023</span>
                </div>
                <button class="download-btn" onclick="downloadNote(this)"><i class="fa-solid fa-download"></i> Download</button>
            </div>

            <!-- Existing Note 2 -->
            <div class="note-card" data-title="Java Programming" data-code="CS302" data-author="Alice J.">
                <div class="note-icon-box icon-doc"><i class="fa-solid fa-file-word"></i></div>
                <div class="note-info">
                    <span class="note-course">CS302</span>
                    <h3>Java OOPS Concepts</h3>
                    <p class="note-desc">Detailed explanation of Inheritance, Polymorphism, Encapsulation and Abstraction.</p>
                </div>
                <div class="note-footer">
                    <div class="author-info">
                        <div class="author-avatar">AJ</div>
                        <span>Alice J.</span>
                    </div>
                    <span>Nov 10, 2023</span>
                </div>
                <button class="download-btn" onclick="downloadNote(this)"><i class="fa-solid fa-download"></i> Download</button>
            </div>

            <!-- Existing Note 3 -->
            <div class="note-card" data-title="Digital Logic" data-code="EC201" data-author="Bob M.">
                <div class="note-icon-box icon-img"><i class="fa-solid fa-file-image"></i></div>
                <div class="note-info">
                    <span class="note-course">EC201</span>
                    <h3>K-Map Solutions</h3>
                    <p class="note-desc">Handwritten notes solving complex Karnaugh Maps for 4 and 5 variables.</p>
                </div>
                <div class="note-footer">
                    <div class="author-info">
                        <div class="author-avatar">BM</div>
                        <span>Bob M.</span>
                    </div>
                    <span>Dec 01, 2023</span>
                </div>
                <button class="download-btn" onclick="downloadNote(this)"><i class="fa-solid fa-download"></i> Download</button>
            </div>

        </div>

    </div>

    <!-- AI WIDGET -->
    <div class="ai-widget" id="ai-widget">
        <div class="ai-minimized" onclick="toggleChat()">
            <span class="widget-status"></span>
            <span>AI Assistant</span>
        </div>
        <div class="chat-interface">
            <div class="chat-header">
                <div class="ai-profile">
                    <div class="ai-avatar-small"><i class="fa-solid fa-robot"></i></div>
                    <span>NexGen Bot</span>
                </div>
                <button class="close-chat" onclick="toggleChat()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="chat-body" id="chat-box"></div>
            <div class="chat-footer">
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Ask anything..." onkeypress="handleEnter(event)">
                    <button class="send-btn" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- UPLOAD MODAL -->
    <div id="uploadModal" class="modal-overlay">
        <div class="modal-content">
            <h3><i class="fa-solid fa-cloud-arrow-up" style="color:var(--primary);"></i> Upload New Note</h3>
            
            <div class="form-group">
                <label class="form-label">Note Title</label>
                <input type="text" id="noteTitle" class="form-input" placeholder="e.g. Unit 4 Summary">
            </div>

            <div style="display:flex; gap:15px;">
                <div class="form-group" style="flex:1;">
                    <label class="form-label">Course Name</label>
                    <input type="text" id="courseName" class="form-input" placeholder="e.g. Data Structures">
                </div>
                <div class="form-group" style="width: 140px;">
                    <label class="form-label">Course Code</label>
                    <input type="text" id="courseCode" class="form-input" placeholder="e.g. CS201">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea id="noteDesc" class="form-textarea" placeholder="Brief description of the contents..."></textarea>
            </div>

            <div class="file-upload-box" onclick="document.getElementById('fileInput').click()">
                <i class="fa-solid fa-file-arrow-up"></i>
                <p>Click to browse or drag file here</p>
                <input type="file" id="fileInput" class="file-input-hidden" onchange="handleFileSelect(this)">
                <div id="fileName" class="file-name-display"></div>
            </div>

            <div class="modal-actions">
                <button class="cancel-btn" onclick="closeUploadModal()">Cancel</button>
                <button class="save-btn" onclick="saveNote()"><i class="fa-solid fa-check"></i> Upload</button>
            </div>
        </div>
    </div>

</div>

<script>
    /* ... existing toggle/search/modal logic ... */
    
    /* THEME TOGGLE */
    const toggleBtn = document.getElementById('theme-toggle');
    const body = document.body;
    const icon = toggleBtn.querySelector('i');
    if(localStorage.getItem('theme') === 'dark') { body.setAttribute('data-theme', 'dark'); icon.classList.replace('fa-moon', 'fa-sun'); }
    toggleBtn.addEventListener('click', () => {
        if(body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme'); icon.classList.replace('fa-sun', 'fa-moon'); localStorage.setItem('theme', 'light');
        } else {
            body.setAttribute('data-theme', 'dark'); icon.classList.replace('fa-moon', 'fa-sun'); localStorage.setItem('theme', 'dark');
        }
    });

    /* SEARCH LOGIC */
    function filterNotes() {
        const input = document.getElementById('repoSearch').value.toLowerCase();
        const cards = document.querySelectorAll('.note-card');

        cards.forEach(card => {
            const title = card.getAttribute('data-title').toLowerCase();
            const code = card.getAttribute('data-code').toLowerCase();
            const author = card.getAttribute('data-author').toLowerCase();
            if(title.includes(input) || code.includes(input) || author.includes(input)) {
                card.style.display = 'flex';
            } else {
                card.style.display = 'none';
            }
        });
    }

    /* MODAL LOGIC */
    function openUploadModal() {
        document.getElementById('uploadModal').style.display = 'flex';
    }
    function closeUploadModal() {
        document.getElementById('uploadModal').style.display = 'none';
        // Reset fields
        document.getElementById('noteTitle').value = '';
        document.getElementById('courseName').value = '';
        document.getElementById('courseCode').value = '';
        document.getElementById('noteDesc').value = '';
        document.getElementById('fileInput').value = '';
        document.getElementById('fileName').style.display = 'none';
    }

    function handleFileSelect(input) {
        if (input.files && input.files[0]) {
            const display = document.getElementById('fileName');
            display.innerText = input.files[0].name;
            display.style.display = 'block';
        }
    }

    function saveNote() {
        const title = document.getElementById('noteTitle').value;
        const code = document.getElementById('courseCode').value;
        const desc = document.getElementById('noteDesc').value;
        const file = document.getElementById('fileInput').files[0];

        if(!title || !code || !file) {
            alert("Please fill in required fields and select a file.");
            return;
        }

        const grid = document.getElementById('notesGrid');
        const newCard = document.createElement('div');
        newCard.className = 'note-card';
        newCard.setAttribute('data-title', title);
        newCard.setAttribute('data-code', code);
        newCard.setAttribute('data-author', 'You'); // Defaulting to user

        // Determine icon based on file type (simple check)
        let iconClass = 'icon-doc';
        let iconHtml = '<i class="fa-solid fa-file"></i>';
        if(file.name.endsWith('.pdf')) { iconClass = 'icon-pdf'; iconHtml = '<i class="fa-solid fa-file-pdf"></i>'; }
        else if(file.name.match(/\.(jpg|jpeg|png|gif)$/)) { iconClass = 'icon-img'; iconHtml = '<i class="fa-solid fa-file-image"></i>'; }

        const date = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

        newCard.innerHTML = `
            <div class="note-icon-box ${iconClass}">${iconHtml}</div>
            <div class="note-info">
                <span class="note-course">${code}</span>
                <h3>${title}</h3>
                <p class="note-desc">${desc || 'No description provided.'}</p>
            </div>
            <div class="note-footer">
                <div class="author-info">
                    <div class="author-avatar" style="background:var(--primary); color:white;">ME</div>
                    <span>You</span>
                </div>
                <span>${date}</span>
            </div>
            <button class="download-btn" onclick="downloadNote(this)"><i class="fa-solid fa-download"></i> Download</button>
        `;

        grid.prepend(newCard);
        closeUploadModal();
    }

    /* DOWNLOAD LOGIC (UPDATED) */
    function downloadNote(btn) {
        // Get note details
        const card = btn.closest('.note-card');
        const title = card.getAttribute('data-title');
        const code = card.getAttribute('data-code');
        const author = card.getAttribute('data-author');
        
        // Visual Feedback
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Downloading...';
        btn.style.pointerEvents = 'none';

        setTimeout(() => {
            // 1. Create content for the file
            const fileContent = `
            NEXGEN NOTES REPOSITORY
            -----------------------
            Title: ${title}
            Course: ${code}
            Author: ${author}
            Downloaded: ${new Date().toLocaleString()}
            
            [This is a simulated file download for the prototype.]
            `;

            // 2. Create a Blob
            const blob = new Blob([fileContent], { type: 'text/plain' });
            
            // 3. Create a link and trigger click
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `${title.replace(/\s+/g, '_')}_Note.txt`; // Safe filename
            document.body.appendChild(a);
            a.click();
            
            // 4. Cleanup
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);

            // 5. Success State
            btn.innerHTML = '<i class="fa-solid fa-check"></i> Saved!';
            btn.style.backgroundColor = 'var(--success)';
            btn.style.color = 'white';
            btn.style.borderColor = 'var(--success)';
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.backgroundColor = ''; 
                btn.style.color = '';
                btn.style.borderColor = '';
                btn.style.pointerEvents = 'auto';
            }, 2000);
        }, 1500);
    }

    /* ... existing chatbot logic ... */
    const widget = document.getElementById('ai-widget');
    const chatBox = document.getElementById('chat-box');
    const chatInput = document.getElementById('chat-input');
    let firstOpen = true;

    function toggleChat() {
        widget.classList.toggle('expanded');
        if(widget.classList.contains('expanded') && firstOpen) {
            firstOpen = false;
            setTimeout(() => {
                addMessage("ai", "Looking for specific notes? I can help you search the repository.");
            }, 500);
        }
    }

    function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

    function sendMessage() {
        const text = chatInput.value.trim();
        if(!text) return;
        addMessage("user", text);
        chatInput.value = '';
        const typingId = showTyping();
        setTimeout(() => {
            removeTyping(typingId);
            addMessage("ai", "I've found 3 related notes for '" + text + "'. Would you like me to list them?");
        }, 1500);
    }

    function addMessage(sender, text) {
        const div = document.createElement('div');
        div.className = `msg msg-${sender}`;
        div.textContent = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function showTyping() {
        const id = 'typing-' + Date.now();
        const div = document.createElement('div');
        div.className = 'typing-indicator';
        div.id = id;
        div.innerHTML = `<div class="dot"></div><div class="dot"></div><div class="dot"></div>`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
        return id;
    }

    function removeTyping(id) {
        const el = document.getElementById(id);
        if(el) el.remove();
    }
</script>

</body>
</html>